---
import RootLayout from '../RootLayout.astro';
---

<RootLayout title="Vanilla UMD Typing Tool Usage Example">
  <div class="mx-auto max-w-[700px] p-8 font-sans">
    <div class="mb-10 text-center">
      <h1 class="mb-2 text-xl font-bold tracking-tight text-slate-200">Vanilla (UMD)</h1>
      <p class="text-[0.95rem] text-slate-400">Lipi Lekhika Typing Tool Usage Example</p>
    </div>

    <div class="mb-7">
      <label
        for="script-select"
        class="mb-2 block text-sm font-semibold tracking-wide text-slate-300">Select Script</label
      >
      <div class="relative">
        <select
          id="script-select"
          class="w-full cursor-pointer appearance-none rounded-lg border border-slate-700 bg-slate-800 px-4 py-3 pr-10 text-base text-slate-200 transition-all duration-200 hover:border-slate-600 focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 focus:outline-none"
        ></select>
        <div
          class="pointer-events-none absolute inset-y-0 right-3 flex items-center text-slate-400"
        >
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M6 9l6 6 6-6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
            ></path>
          </svg>
        </div>
      </div>
    </div>

    <div class="mb-7">
      <textarea
        id="textarea"
        placeholder="Start typing here..."
        class="min-h-[150px] w-full resize-y rounded-lg border border-slate-700 bg-slate-800 px-4 py-3 text-base leading-relaxed text-slate-200 transition-all duration-200 placeholder:text-slate-500 hover:border-slate-600 focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 focus:outline-none"
      ></textarea>
    </div>

    <div class="mb-7">
      <input
        id="input"
        type="text"
        placeholder="Type here..."
        class="w-full rounded-lg border border-slate-700 bg-slate-800 px-4 py-3 text-base text-slate-200 transition-all duration-200 placeholder:text-slate-500 hover:border-slate-600 focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 focus:outline-none"
      />
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/lipilekhika" is:inline></script>
  <script is:inline>
    const select = document.getElementById('script-select');
    const textarea = document.getElementById('textarea');
    const input = document.getElementById('input');

    // Populate scripts
    for (const script of lipilekhika.SCRIPT_LIST) {
      const opt = document.createElement('option');
      opt.value = script;
      opt.textContent = script;
      select.appendChild(opt);
    }

    let selectedScript = 'Devanagari';
    select.value = selectedScript;

    let textareaCtx;
    let inputCtx;
    Promise.all([
      lipilekhika.preloadScriptData(selectedScript),
      lipilekhika.preloadScriptData('Normal')
    ]).then(() => {
      textareaCtx = lipilekhika.typing.createTypingContext(selectedScript);
      inputCtx = lipilekhika.typing.createTypingContext(selectedScript);
    });

    async function resetContexts(nextScript) {
      selectedScript = nextScript;
      textareaCtx.clearContext();
      inputCtx.clearContext();
      await lipilekhika.preloadScriptData(selectedScript);
      textareaCtx = lipilekhika.typing.createTypingContext(selectedScript);
      inputCtx = lipilekhika.typing.createTypingContext(selectedScript);
    }

    select.addEventListener('change', (e) => {
      const next = e.currentTarget?.value;
      if (typeof next === 'string' && next.length > 0) resetContexts(next);
    });

    textarea.addEventListener('beforeinput', async (e) => {
      await lipilekhika.typing.handleTypingInputEvent(textareaCtx, e, (newValue) => {
        textarea.value = newValue;
      });
    });
    textarea.addEventListener('blur', () => textareaCtx.clearContext());
    textarea.addEventListener('keydown', (e) =>
      lipilekhika.typing.clearTypingContextOnKeyDown(e, textareaCtx)
    );

    input.addEventListener('beforeinput', async (e) => {
      await lipilekhika.typing.handleTypingInputEvent(inputCtx, e, (newValue) => {
        input.value = newValue;
      });
    });
    input.addEventListener('blur', () => inputCtx.clearContext());
    input.addEventListener('keydown', (e) =>
      lipilekhika.typing.clearTypingContextOnKeyDown(e, inputCtx)
    );
  </script>
</RootLayout>
