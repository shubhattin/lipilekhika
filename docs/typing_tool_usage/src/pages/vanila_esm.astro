---
import RootLayout from '../RootLayout.astro';
---

<RootLayout title="Vanilla ESM Typing Tool Usage Example">
  <div class="mx-auto max-w-[700px] p-8 font-sans">
    <div class="mb-10 text-center">
      <h1 class="mb-2 text-xl font-bold tracking-tight text-slate-200">Vanilla (ESM)</h1>
      <p class="text-[0.95rem] text-slate-400">Lipi Lekhika Typing Tool Usage Example</p>
    </div>

    <div class="mb-7">
      <label
        for="script-select"
        class="mb-2 block text-sm font-semibold tracking-wide text-slate-300">Select Script</label
      >
      <div class="relative">
        <select
          id="script-select"
          class="w-full cursor-pointer appearance-none rounded-lg border border-slate-700 bg-slate-800 px-4 py-3 pr-10 text-base text-slate-200 transition-all duration-200 hover:border-slate-600 focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 focus:outline-none"
        ></select>
        <div
          class="pointer-events-none absolute inset-y-0 right-3 flex items-center text-slate-400"
        >
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M6 9l6 6 6-6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
            ></path>
          </svg>
        </div>
      </div>
    </div>

    <div class="mb-7">
      <textarea
        id="textarea"
        placeholder="Start typing here..."
        class="min-h-[150px] w-full resize-y rounded-lg border border-slate-700 bg-slate-800 px-4 py-3 text-base leading-relaxed text-slate-200 transition-all duration-200 placeholder:text-slate-500 hover:border-slate-600 focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 focus:outline-none"
      ></textarea>
    </div>

    <div class="mb-7">
      <input
        id="input"
        type="text"
        placeholder="Type here..."
        class="w-full rounded-lg border border-slate-700 bg-slate-800 px-4 py-3 text-base text-slate-200 transition-all duration-200 placeholder:text-slate-500 hover:border-slate-600 focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 focus:outline-none"
      />
    </div>

    <script type="module" is:inline>
      import { SCRIPT_LIST } from 'https://cdn.jsdelivr.net/npm/lipilekhika/dist/esm/index.mjs';
      import {
        createTypingContext,
        clearTypingContextOnKeyDown,
        handleTypingInputEvent
      } from 'https://cdn.jsdelivr.net/npm/lipilekhika/dist/esm/typing.mjs';

      const select = document.getElementById('script-select');
      const textarea = document.getElementById('textarea');
      const input = document.getElementById('input');

      // Populate scripts
      for (const script of SCRIPT_LIST) {
        const opt = document.createElement('option');
        opt.value = script;
        opt.textContent = script;
        select.appendChild(opt);
      }

      let selectedScript = 'Devanagari';
      select.value = selectedScript;

      let textareaCtx = createTypingContext(selectedScript);
      let inputCtx = createTypingContext(selectedScript);

      function resetContexts(nextScript) {
        selectedScript = nextScript;
        textareaCtx.clearContext();
        inputCtx.clearContext();
        textareaCtx = createTypingContext(selectedScript);
        inputCtx = createTypingContext(selectedScript);
      }

      select.addEventListener('change', (e) => {
        const next = e.currentTarget?.value;
        if (typeof next === 'string' && next.length > 0) resetContexts(next);
      });

      textarea.addEventListener('input', async (e) => {
        await handleTypingInputEvent(textareaCtx, e, (newValue) => {
          textarea.value = newValue;
        });
      });
      textarea.addEventListener('blur', () => textareaCtx.clearContext());
      textarea.addEventListener('keydown', (e) => clearTypingContextOnKeyDown(e, textareaCtx));

      input.addEventListener('input', async (e) => {
        await handleTypingInputEvent(inputCtx, e, (newValue) => {
          input.value = newValue;
        });
      });
      input.addEventListener('blur', () => inputCtx.clearContext());
      input.addEventListener('keydown', (e) => clearTypingContextOnKeyDown(e, inputCtx));
    </script>
  </div>
</RootLayout>
