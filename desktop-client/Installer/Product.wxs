<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <Product Id="*" 
           Name="Lipi Lekhika" 
           Language="1033"
           Version="$(var.ProductVersion)" 
           Manufacturer="Shubham Anand Gupta"
           UpgradeCode="93b58ef9-666b-4caf-8efb-b4ce4b91c044">
    
    <Package InstallerVersion="500" 
             Compressed="yes" 
             InstallScope="perMachine"
             Description="Lipi Lekhika - Indic Script Typing Tool"
             Manufacturer="Shubham Anand Gupta"
             Comments="Installer for Lipi Lekhika application" />

    <!-- MajorUpgrade allows replacing previous versions -->
    <!-- AllowSameVersionUpgrades="yes" -->
    <MajorUpgrade 
        Schedule="afterInstallInitialize"
        DowngradeErrorMessage="A newer version of [ProductName] is already installed." />

    <MediaTemplate EmbedCab="yes" />
    
    <Feature Id="ProductFeature" Title="Lipi Lekhika" Level="1">
      <ComponentGroupRef Id="ProductComponents" />
      <ComponentGroupRef Id="LicenseComponents" />
    </Feature>

    <!-- Application Icons (uses separate .ico files instead of executables to reduce installer size) -->
    <Icon Id="AppIcon" SourceFile="$(var.StagingPath)\lipilekhika.ico" />
    <Icon Id="LipiparivartakaIcon" SourceFile="$(var.StagingPath)\lipiparivartaka.ico" />
    <Property Id="ARPPRODUCTICON" Value="AppIcon" />
    
    <!-- Add/Remove Programs metadata -->
    <Property Id="ARPURLINFOABOUT" Value="https://github.com/shubhattin/lipilekhika" />
    <Property Id="ARPCONTACT" Value="Shubham Anand Gupta" />
    <Property Id="ARPCOMMENTS" Value="Indic Script Typing Tool for Windows" />

    <!-- UI -->
    <UIRef Id="WixUI_InstallDir" />
    <UIRef Id="WixUI_ErrorProgressText" />
    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLFOLDER"/>
    
    <!-- License -->
    <WixVariable Id="WixUILicenseRtf" Value="$(var.StagingPath)\License.rtf" />
  </Product>

  <Fragment>
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFilesFolder">
        <Directory Id="INSTALLFOLDER" Name="Lipi Lekhika" />
      </Directory>

      <Directory Id="ProgramMenuFolder">
        <Directory Id="ApplicationProgramsFolder" Name="Lipi Lekhika" />
      </Directory>

      <Directory Id="DesktopFolder" />
    </Directory>
  </Fragment>

  <Fragment>
    <ComponentGroup Id="ProductComponents">
      <!-- Main exe - Lipi Lekhika -->
      <Component Id="LipilekhikaExeComponent" Guid="b2c3d4e5-f6a7-8901-bcde-f23456789012" Directory="INSTALLFOLDER">
        <File Id="LipilekhikaExe" 
              Source="$(var.StagingPath)\lipilekhika.exe" 
              KeyPath="yes" 
              Checksum="yes" />
      </Component>

      <!-- Lipi Parivartaka exe -->
      <Component Id="LipiparivartakaExeComponent" Guid="c3d4e5f6-a7b8-9012-cdef-345678901234" Directory="INSTALLFOLDER">
        <File Id="LipiparivartakaExe" 
              Source="$(var.StagingPath)\lipiparivartaka.exe" 
              KeyPath="yes" 
              Checksum="yes" />
      </Component>

      <!-- Start Menu shortcut for Lipi Lekhika -->
      <Component Id="LipilekhikaStartMenuShortcut" Guid="e5f6a7b8-c9d0-1234-efab-567890123456" Directory="ApplicationProgramsFolder">
        <Shortcut Id="LipilekhikaStartMenuLink" 
                  Name="Lipi Lekhika" 
                  Description="Lipi Lekhika - Indic Script Typing Tool" 
                  Target="[INSTALLFOLDER]lipilekhika.exe" 
                  WorkingDirectory="INSTALLFOLDER" 
                  Icon="AppIcon" 
                  IconIndex="0" />
        <RemoveFolder Id="RemoveProgramMenuFolder" Directory="ApplicationProgramsFolder" On="uninstall"/>
        <RegistryValue Root="HKCU" Key="Software\LipiLekhika" Name="StartMenuShortcut" Type="integer" Value="1" KeyPath="yes"/>
      </Component>

      <!-- Start Menu shortcut for Lipi Parivartaka -->
      <Component Id="LipiparivartakaStartMenuShortcut" Guid="f6a7b8c9-d0e1-2345-fabc-678901234567" Directory="ApplicationProgramsFolder">
        <Shortcut Id="LipiparivartakaStartMenuLink" 
                  Name="Lipi Parivartaka" 
                  Description="Lipi Parivartaka - Script Transliteration Tool" 
                  Target="[INSTALLFOLDER]lipiparivartaka.exe" 
                  WorkingDirectory="INSTALLFOLDER" 
                  Icon="LipiparivartakaIcon" 
                  IconIndex="0" />
        <RegistryValue Root="HKCU" Key="Software\LipiLekhika" Name="LipiparivartakaStartMenuShortcut" Type="integer" Value="1" KeyPath="yes"/>
      </Component>

      <!-- Desktop shortcut for Lipi Lekhika -->
      <Component Id="LipilekhikaDesktopShortcut" Guid="a7b8c9d0-e1f2-3456-abcd-789012345678" Directory="DesktopFolder">
        <Shortcut Id="LipilekhikaDesktopLink" 
                  Name="Lipi Lekhika" 
                  Description="Lipi Lekhika - Indic Script Typing Tool" 
                  Target="[INSTALLFOLDER]lipilekhika.exe" 
                  WorkingDirectory="INSTALLFOLDER" 
                  Icon="AppIcon" 
                  IconIndex="0" />
        <RegistryValue Root="HKCU" Key="Software\LipiLekhika" Name="DesktopShortcut" Type="integer" Value="1" KeyPath="yes"/>
      </Component>


    </ComponentGroup>

    <!-- License file component -->
    <ComponentGroup Id="LicenseComponents">
      <Component Id="LicenseFileComponent" Guid="c9d0e1f2-a3b4-5678-cdef-901234567890" Directory="INSTALLFOLDER">
        <File Id="LicenseFile" 
              Source="$(var.StagingPath)\LICENSE.txt" 
              KeyPath="yes" />
      </Component>
    </ComponentGroup>
  </Fragment>
</Wix>
